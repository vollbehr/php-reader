> **Summary:** Developer Reference Guide: `Vollbehr\\Media\\Iso14496`
> **Labels:** implementation,iso-base-media


# PHP Reader Documentation: `Vollbehr\Media\Iso14496`
By [svollbehr](https://github.com/svollbehr)

## Introduction
`Vollbehr\Media\Iso14496` implements the ISO/IEC 14496-12 Base Media File Format. The parser handles
QuickTime, MPEG-4 Part 14 (MP4/M4A/M4V), and other derivatives that reuse the atom/box structure.

![Diagram](model/model.iso14496.png)

## Class Information

- Documentation: <https://developers.vollbehr.io/docs/api/Vollbehr/Media/Iso14496.html>
- Source: <https://github.com/vollbehr/php-reader/blob/main/src/Vollbehr/Media/Iso14496.php>
- Requirements:
  - `Vollbehr\Io\FileReader`
  - `Vollbehr\Media\Iso14496\Box`
  - `Vollbehr\Media\Iso14496\Exception`

Every box under the specification maps to a PHP class under `Vollbehr\Media\Iso14496\Box`. Platform
extensions such as Apple's `ilst` metadata atoms and MP4RA's `id32` box also ship with dedicated
classes.

## Traversing boxes
The ISO base media format nests boxes (atoms) hierarchically. PHP Reader exposes them as objects that
implement `getBoxes()` and typed accessors so you can explore the tree.

```php
<?php

declare(strict_types=1);

use Vollbehr\Media\Iso14496;
use Vollbehr\Media\Iso14496\Box\FullContainer;

$iso = new Iso14496('/path/to/example.m4a');

foreach ($iso->getBoxes() as $boxGroup) {
    foreach ($boxGroup as $box) {
        printf("%s (%s)\n", $box::class, $box->getIdentifier());
    }
}

/**
 * @param FullContainer $container
 * @param int           $depth
 */
function walkBoxes(FullContainer $container, int $depth = 0): void
{
    foreach ($container->getBoxes() as $groups) {
        foreach ($groups as $box) {
            printf("%s%s (%s)\n", str_repeat('    ', $depth), $box::class, $box->getIdentifier());

            if ($box instanceof FullContainer) {
                walkBoxes($box, $depth + 1);
            }
        }
    }
}

if (isset($iso->moov)) {
    walkBoxes($iso->moov);
}
```

## Extracting metadata

```php
<?php

declare(strict_types=1);

use Vollbehr\Media\Iso14496;

$iso    = new Iso14496('/path/to/example.m4a');
$moov   = $iso->moov;
$udta   = $moov?->udta;
$meta   = $udta?->meta;
$ilst   = $meta?->ilst;
$artist = $ilst?->soar?->getText();

if ($artist !== null) {
    printf("Artist: %s\n", $artist);
}
```

Refer to the individual box classes in the API reference for their properties and behaviour.

## Issues
- GitHub tracker: <https://github.com/vollbehr/php-reader/issues?q=is%3Aissue+label%3AISO14496>
